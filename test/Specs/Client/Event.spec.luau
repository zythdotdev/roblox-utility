return function()
	local ReplicatedStorage = game:GetService("ReplicatedStorage")
    local Event = require(ReplicatedStorage.Modules.Event)

    describe("Event", function()
		it("Should create a new event", function()
			local event = Event.new()
			expect(event).to.be.ok()
			expect(event.className).to.equal("Event")
		end)
		it("Should fire the event", function()
			local event = Event.new()
			local fired = false
			event:Connect(function(args)
				fired = true
			end)
			event:Fire()
			task.defer(function()
				expect(fired).to.equal(true)
			end)
		end)
		it("Should fire the event with a value", function()
			local event = Event.new()
			local fired
			event:Connect(function(value)
				fired = value
			end)
			event:Fire("Hello, world!")
			task.defer(function()
				expect(fired).to.equal("Hello, world!")
			end)
		end)
		it("Should fire with multiple arguments", function()
			local event = Event.new()
			local arg1, arg2, arg3
			event:Connect(function(a, b, c)
				arg1, arg2, arg3 = a, b, c
			end)
			event:Fire(1, "test", true)
			task.wait()
			expect(arg1).to.equal(1)
			expect(arg2).to.equal("test")
			expect(arg3).to.equal(true)
		end)
		it("Should wait for the event to fire", function()
			local event = Event.new()
			local fired = false
			task.spawn(function()
				fired = event:WaitAsync()
			end)
			expect(fired).to.equal(false)
			task.delay(0.1, function()
				event:Fire(true)
				expect(fired).to.equal(true)
			end)
		end)
		it("Should timeout when waiting for the event", function()
			local event = Event.new()
			local fired = event:WaitAsync(0.1)
			expect(fired).to.equal(nil)
			task.spawn(function()
				fired = event:WaitAsync(0.2)
				expect(fired).to.equal(123)
			end)
			event:Fire(123)
		end)
		it("Should disconnect the event", function()
			local event = Event.new()
			local fired = false
			local connection = event:Connect(function()
				fired = true
			end)
			connection:Disconnect()
			event:Fire()
			expect(fired).to.equal(false)
		end)
		it("Should report IsConnected correctly", function()
			local event = Event.new()
			local connection = event:Connect(function() end)
			expect(connection:IsConnected()).to.equal(true)
			connection:Disconnect()
			expect(connection:IsConnected()).to.equal(false)
		end)
		it("Should handle multiple disconnects gracefully", function()
			local event = Event.new()
			local connection = event:Connect(function() end)
			connection:Disconnect()
			connection:Disconnect() -- Should not error
			expect(connection:IsConnected()).to.equal(false)
		end)
		it("Should destroy the event", function()
			local event = Event.new()
			event:Destroy()
			expect(event._Destroyed).to.equal(true)
			expect(event._Head).to.equal(nil)
		end)
		it("Should handle multiple destroys gracefully", function()
			local event = Event.new()
			event:Destroy()
			event:Destroy() -- Should not error
			expect(event._Destroyed).to.equal(true)
		end)
		it("Should prevent connecting to destroyed event", function()
			local event = Event.new()
			event:Destroy()
			expect(function()
				event:Connect(function() end)
			end).to.throw()
		end)
		it("Should prevent Once on destroyed event", function()
			local event = Event.new()
			event:Destroy()
			expect(function()
				event:Once(function() end)
			end).to.throw()
		end)
		it("Should prevent WaitAsync on destroyed event", function()
			local event = Event.new()
			event:Destroy()
			expect(function()
				event:WaitAsync()
			end).to.throw()
		end)
		it("Should silently ignore firing destroyed event", function()
			local event = Event.new()
			local fired = false
			event:Connect(function()
				fired = true
			end)
			event:Destroy()
			event:Fire()
			task.wait()
			expect(fired).to.equal(false)
		end)
		it("Should connect once", function()
			local event = Event.new()
			local count = 0
			event:Once(function()
				count += 1
			end)
			event:Fire()
			event:Fire()
			task.defer(function()
				expect(count).to.equal(1)
			end)
		end)
		it("Should disconnect all connections", function()
			local event = Event.new()
			local fired = false
			event:Connect(function()
				fired = true
			end)
			event:DisconnectAll()
			event:Fire()
			expect(fired).to.equal(false)
		end)
		it("Should handle multiple connections", function()
			local event = Event.new()
			local count = 0
			event:Connect(function() count += 1 end)
			event:Connect(function() count += 1 end)
			event:Connect(function() count += 1 end)
			event:Fire()
			task.wait()
			expect(count).to.equal(3)
		end)
		it("Should disconnect specific connection without affecting others", function()
			local event = Event.new()
			local count1, count2, count3 = 0, 0, 0
			event:Connect(function() count1 += 1 end)
			local conn2 = event:Connect(function() count2 += 1 end)
			event:Connect(function() count3 += 1 end)

			conn2:Disconnect()
			event:Fire()
			task.wait()

			expect(count1).to.equal(1)
			expect(count2).to.equal(0)
			expect(count3).to.equal(1)
		end)
		it("Should validate timeout is non-negative", function()
			local event = Event.new()
			expect(function()
				event:WaitAsync(-1)
			end).to.throw()
		end)
		it("Should clean up node references on disconnect", function()
			local event = Event.new()
			local connection = event:Connect(function() end)
			connection:Disconnect()

			expect(connection._Node.Next).to.equal(nil)
			expect(connection._Node.Callback).to.equal(nil)
		end)
		it("Should pass tables by reference", function()
			local event = Event.new()
			local receivedTable
			event:Connect(function(t)
				receivedTable = t
			end)

			local originalTable = {value = 42}
			event:Fire(originalTable)
			task.wait()

			expect(receivedTable).to.equal(originalTable)
			receivedTable.value = 100
			expect(originalTable.value).to.equal(100)
		end)
    end)
end